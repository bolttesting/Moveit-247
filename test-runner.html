<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoveIt 247 - Functionality Test Runner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .content {
            padding: 20px;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #64748b;
            font-weight: 600;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
        }

        .stat-value.passed { color: #10b981; }
        .stat-value.failed { color: #ef4444; }
        .stat-value.warnings { color: #f59e0b; }

        .console-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.6;
        }

        .console-output .log {
            margin-bottom: 5px;
        }

        .console-output .pass {
            color: #10b981;
        }

        .console-output .fail {
            color: #ef4444;
        }

        .console-output .warn {
            color: #f59e0b;
        }

        .console-output .info {
            color: #3b82f6;
        }

        .test-list {
            margin-top: 20px;
        }

        .test-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid;
            background: #f8f9fa;
        }

        .test-item.passed {
            border-left-color: #10b981;
            background: #ecfdf5;
        }

        .test-item.failed {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .test-item.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .test-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .test-error {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .instructions {
            background: #f0f9ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #1e40af;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 8px;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ MoveIt 247 - Functionality Test Suite</h1>
            <p>Comprehensive testing of all buttons, features, and functionalities</p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="runTests()">
                ‚ñ∂Ô∏è Run All Tests
            </button>
            <button class="btn btn-success" onclick="runQuickTests()">
                ‚ö° Quick Test
            </button>
            <button class="btn btn-danger" onclick="clearOutput()">
                üóëÔ∏è Clear Output
            </button>
            <button class="btn btn-secondary" onclick="exportResults()">
                üì• Export Results
            </button>
        </div>

        <div class="content">
            <div class="instructions">
                <h3>üìã Instructions</h3>
                <ol>
                    <li>Make sure you are logged into the MoveIt 247 application in another tab</li>
                    <li>Or open the application in an iframe below and log in there</li>
                    <li>Click "Run All Tests" to test all functionalities</li>
                    <li>Tests will check buttons, forms, modals, navigation, and features</li>
                    <li>View results in the console output below</li>
                </ol>
            </div>

            <div class="status-bar">
                <div class="stat">
                    <span class="stat-label">Passed</span>
                    <span class="stat-value passed" id="passed-count">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Failed</span>
                    <span class="stat-value failed" id="failed-count">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Warnings</span>
                    <span class="stat-value warnings" id="warnings-count">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Duration</span>
                    <span class="stat-value" id="duration">0s</span>
                </div>
            </div>

            <div class="console-output" id="console-output">
                <div class="log info">Ready to run tests. Click "Run All Tests" to start.</div>
            </div>

            <div class="test-list" id="test-list"></div>
        </div>
    </div>

    <script src="test-all-functionalities.js"></script>
    <script>
        let testResults = null;
        const output = document.getElementById('console-output');
        const testList = document.getElementById('test-list');

        function addLog(message, type = 'info') {
            const log = document.createElement('div');
            log.className = `log ${type}`;
            log.textContent = message;
            output.appendChild(log);
            output.scrollTop = output.scrollHeight;
        }

        function updateStats(results) {
            document.getElementById('passed-count').textContent = results.passed.length;
            document.getElementById('failed-count').textContent = results.failed.length;
            document.getElementById('warnings-count').textContent = results.warnings.length;
            document.getElementById('duration').textContent = results.duration ? `${results.duration}s` : '0s';
        }

        function clearOutput() {
            output.innerHTML = '';
            testList.innerHTML = '';
            updateStats({ passed: [], failed: [], warnings: [] });
            testResults = null;
            addLog('Output cleared.', 'info');
        }

        async function runTests() {
            clearOutput();
            addLog('üöÄ Starting Comprehensive Functionality Test Suite...', 'info');
            addLog('='.repeat(60), 'info');

            try {
                // Override console.log to capture output
                const originalLog = console.log;
                console.log = function(...args) {
                    originalLog.apply(console, args);
                    addLog(args.join(' '), 'info');
                };

                // Check if app is available
                if (typeof app === 'undefined') {
                    addLog('‚ö†Ô∏è Warning: Application not detected. Some tests may be skipped.', 'warn');
                    addLog('üí° Tip: Open the application in this tab first, or run tests from the application page.', 'info');
                }

                const results = await TestSuite.runAllTests();
                testResults = results;

                // Restore console.log
                console.log = originalLog;

                // Display results
                addLog('\nüìä TEST SUMMARY', 'info');
                addLog('='.repeat(60), 'info');
                addLog(`‚úÖ Passed: ${results.passed}`, 'pass');
                addLog(`‚ùå Failed: ${results.failed}`, 'fail');
                addLog(`‚ö†Ô∏è  Warnings: ${results.warnings}`, 'warn');
                addLog(`‚è±Ô∏è  Duration: ${results.duration}s`, 'info');

                // Update stats
                updateStats({
                    passed: Array(results.passed).fill(0),
                    failed: Array(results.failed).fill(0),
                    warnings: Array(results.warnings).fill(0),
                    duration: results.duration
                });

                // Display detailed results
                displayTestList(results);

            } catch (error) {
                addLog(`üí• Error running tests: ${error.message}`, 'fail');
                console.error(error);
            }
        }

        async function runQuickTests() {
            clearOutput();
            addLog('‚ö° Running Quick Tests (Essential Features Only)...', 'info');

            const quickTests = [
                () => TestSuite.test('Login form exists', () => {
                    const form = document.getElementById('login-form') || document.querySelector('form[id*="login"]');
                    if (!form) throw new Error('Login form not found');
                }),
                () => TestSuite.test('App container exists', () => {
                    const container = document.getElementById('app-container') || document.querySelector('[id*="app"]');
                    if (!container) throw new Error('App container not found');
                }),
                () => TestSuite.test('Navigation works', async () => {
                    if (typeof app !== 'undefined' && app.navigateTo) {
                        await app.navigateTo('dashboard');
                        await TestSuite.delay(500);
                    }
                })
            ];

            for (const test of quickTests) {
                try {
                    await test();
                } catch (e) {
                    addLog(`Quick test failed: ${e.message}`, 'fail');
                }
            }

            addLog('Quick tests completed.', 'info');
        }

        function displayTestList(results) {
            testList.innerHTML = '';

            // Display passed tests
            if (results.details && results.details.passed) {
                results.details.passed.forEach(testName => {
                    const item = document.createElement('div');
                    item.className = 'test-item passed';
                    item.innerHTML = `
                        <div class="test-name">‚úÖ ${testName}</div>
                    `;
                    testList.appendChild(item);
                });
            }

            // Display failed tests
            if (results.details && results.details.failed) {
                results.details.failed.forEach(fail => {
                    const item = document.createElement('div');
                    item.className = 'test-item failed';
                    item.innerHTML = `
                        <div class="test-name">‚ùå ${fail.name}</div>
                        <div class="test-error">${fail.error}</div>
                    `;
                    testList.appendChild(item);
                });
            }

            // Display warnings
            if (results.details && results.details.warnings) {
                results.details.warnings.forEach(warn => {
                    const item = document.createElement('div');
                    item.className = 'test-item warning';
                    item.innerHTML = `
                        <div class="test-name">‚ö†Ô∏è ${warn.name}</div>
                        <div class="test-error">${warn.message}</div>
                    `;
                    testList.appendChild(item);
                });
            }
        }

        function exportResults() {
            if (!testResults) {
                alert('No test results to export. Run tests first.');
                return;
            }

            const data = {
                timestamp: new Date().toISOString(),
                summary: {
                    passed: testResults.passed,
                    failed: testResults.failed,
                    warnings: testResults.warnings,
                    duration: testResults.duration
                },
                details: testResults.details
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-results-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Auto-detect if we're on the application page
        window.addEventListener('load', () => {
            if (typeof app !== 'undefined') {
                addLog('‚úÖ Application detected. Ready to run tests.', 'pass');
            } else {
                addLog('‚ö†Ô∏è Application not detected. Open the MoveIt 247 app first.', 'warn');
            }
        });
    </script>
</body>
</html>

